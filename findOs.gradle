/**
 * Auto find java by env variables on Win & OS X
 * Modified version of https://gist.github.com/tiwiz/a2bd1f5249147e017730
 */

String getJavaHome(String version) {
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine "/usr/libexec/java_home", "-v", version
        standardOutput = stdout;
    }
    return stdout.toString().trim()
}

/**
 * Todo fix so it doesn't go bananas on non osx without env specified.
 */
task findOs {
    doLast {
        println("Adding retrolmbda")
        retrolambda {
            jdk System.getenv("JAVA8_HOME") ?: getJavaHome("1.8")
            oldJdk System.getenv("JAVA7_HOME") ?: getJavaHome("1.7")
        }
    }
}
